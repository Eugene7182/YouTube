services:
  - type: web
    name: shorts-api
    env: python
    plan: free
    buildCommand: pip install -r requirements.txt
    startCommand: uvicorn server:app --host 0.0.0.0 --port 10000
    autoDeploy: true
    envVars:
      - key: YOUTUBE_CLIENT_SECRET_JSON
        sync: false
      - key: YOUTUBE_TOKEN_JSON
        sync: false
      - key: YOUTUBE_API_KEY
        sync: false
      - key: CHANNEL_DEFAULT_TAGS
        value: "shorts,cartoon,comedy"
      - key: DEFAULT_CATEGORY_ID
        value: "1"
      - key: DEFAULT_PRIVACY
        value: private
      - key: TZ_TARGET
        value: America/New_York
      - key: TZ_LOCAL
        value: Asia/Almaty
      - key: RENDER_DEPLOY
        value: "1"
      - key: ADMIN_TOKEN
        sync: false
      - key: SERVICE_BASE_URL
        sync: false
      - key: YOUTUBE_DRY_RUN
        value: "0"
cronJobs:
  - name: daily-run-queue
    type: cron
    env: python
    plan: free
    schedule: "0 13 * * *"
    buildCommand: pip install -r requirements.txt
    startCommand: python -m tasks.run_queue --upload
    autoDeploy: true
    envVars:
      - key: YOUTUBE_CLIENT_SECRET_JSON
        sync: false
      - key: YOUTUBE_TOKEN_JSON
        sync: false
      - key: YOUTUBE_API_KEY
        sync: false
      - key: CHANNEL_DEFAULT_TAGS
        value: "shorts,cartoon,comedy"
      - key: DEFAULT_CATEGORY_ID
        value: "1"
      - key: DEFAULT_PRIVACY
        value: private
      - key: TZ_TARGET
        value: America/New_York
      - key: TZ_LOCAL
        value: Asia/Almaty
      - key: RENDER_DEPLOY
        value: "1"
      - key: ADMIN_TOKEN
        sync: false
      - key: SERVICE_BASE_URL
        sync: false
      - key: YOUTUBE_DRY_RUN
        value: "0"
  - name: daily-fetch-trends
    type: cron
    env: python
    plan: free
    schedule: "0 12 * * *"
    buildCommand: pip install -r requirements.txt
    startCommand: python -m tasks.fetch_trending_shorts
    autoDeploy: true
    envVars:
      - key: YOUTUBE_CLIENT_SECRET_JSON
        sync: false
      - key: YOUTUBE_TOKEN_JSON
        sync: false
      - key: YOUTUBE_API_KEY
        sync: false
      - key: CHANNEL_DEFAULT_TAGS
        value: "shorts,cartoon,comedy"
      - key: DEFAULT_CATEGORY_ID
        value: "1"
      - key: DEFAULT_PRIVACY
        value: private
      - key: TZ_TARGET
        value: America/New_York
      - key: TZ_LOCAL
        value: Asia/Almaty
      - key: RENDER_DEPLOY
        value: "1"
      - key: ADMIN_TOKEN
        sync: false
      - key: SERVICE_BASE_URL
        sync: false
      - key: YOUTUBE_DRY_RUN
        value: "0"
  - name: seed-month-once
    type: cron
    env: python
    plan: free
    schedule: "0 11 22 9 *"
    buildCommand: pip install -r requirements.txt
    startCommand: python -m tasks.seed_month --days 30 --slot "09:00 ET" --start 2025-09-22
    autoDeploy: true
    envVars:
      - key: YOUTUBE_CLIENT_SECRET_JSON
        sync: false
      - key: YOUTUBE_TOKEN_JSON
        sync: false
      - key: YOUTUBE_API_KEY
        sync: false
      - key: CHANNEL_DEFAULT_TAGS
        value: "shorts,cartoon,comedy"
      - key: DEFAULT_CATEGORY_ID
        value: "1"
      - key: DEFAULT_PRIVACY
        value: private
      - key: TZ_TARGET
        value: America/New_York
      - key: TZ_LOCAL
        value: Asia/Almaty
      - key: RENDER_DEPLOY
        value: "1"
      - key: ADMIN_TOKEN
        sync: false
      - key: SERVICE_BASE_URL
        sync: false
      - key: YOUTUBE_DRY_RUN
        value: "0"
